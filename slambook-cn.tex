% !Mode:: "TeX:UTF-8"
\documentclass[openleft]{book}
\input{latex/package}
\input{latex/option}
\input{latex/hack}

\makeatletter

\setCJKmainfont[BoldFont=方正黑体_GBK,ItalicFont=方正楷体_GBK]{方正书宋_GBK}
\setCJKsansfont[BoldFont=方正黑体_GBK]{方正准圆_GBK}
\setCJKmonofont[BoldFont=方正黑体_GBK]{方正楷体_GBK}
\setmainfont{Times New Roman}
%\setsansfont{Menlo}
\setmonofont{Monaco}
%\setmonofont{Menlo}
\newCJKfontfamily{\FZDBSK}{方正大标宋_GBK}
\newCJKfontfamily{\FZXBSK}{方正小标宋_GBK}
\newCJKfontfamily{\FZHTK}{方正黑体_GBK}
\newCJKfontfamily{\FZKTK}{方正楷体_GBK}
\newCJKfontfamily{\FZFSK}{方正仿宋_GBK}
\newCJKfontfamily{\FZYZK}{方正准圆_GBK}

\makeatother

\newpagestyle{special}[\sffamily\FZHTK\small]{
  \sethead[\thepage][][\chaptertitle]
          {\chaptertitle}{}{\thepage}
}
\newpagestyle{main}[\sffamily\FZHTK\small]{
  \sethead[\thepage][][视觉SLAM十四讲：从理论到实践]
          {\CTEXthechapter\quad\chaptertitle}{}{\thepage}
}

\usepackage{titletoc}
\contentsmargin{1.75em}
\dottedcontents{chapter}[4em]{\bfseries}{4em}{5pt}
\dottedcontents{section}[4em]{}{2.75em}{3pt}
\dottedcontents{subsection}[7em]{\FZKTK}{3em}{3pt}


\setlength{\skip\footins}{5mm}
\setlength\parskip{1pt}

\renewcommand{\arraystretch}{1.2}

\begin{document}
\frontmatter % 开始前言目录，页码用罗马数字
\addtocontents{toc}{\protect\setcounter{tocdepth}{-1}}
\hypersetup{bookmarksdepth=0}
\pdfbookmark[0]{扉页}{titlepage}
\includepdf[noautoscale]{titlepage}
\pagestyle{empty}
\pdfbookmark[0]{版权页}{copyright}
\include{copyright}
\pagestyle{special}

% 读者须知
\input{latex/reader}

% 版权
\pdfbookmark[0]{\contentsname}{copyright}

% 第二版序言
\input{chapters/prelog-version2}

\tableofcontents % 目录

\mainmatter % 开始正文，页码用阿拉伯数字
\pagestyle{main}
\addtocontents{toc}{\protect\setcounter{tocdepth}{2}}
\hypersetup{bookmarksdepth=2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% ch1 前言
\input{chapters-cn/introduction}
\thispagestyle{empty}
\part{数学基础}
\thispagestyle{empty}
% ch2 概述
\include{chapters-cn/whatSlam}
% ch3 三维刚体运动
\include{chapters-cn/3dmotion}
% ch4 李代数
\include{chapters-cn/lieGroup}
% ch5 相机与图像
\include{chapters-cn/cameraModel}
% ch6 非线性优化
\include{chapters-cn/nonlinearOptimization}
\part{实践应用}
\thispagestyle{empty}
% ch7 视觉里程计
\include{chapters-cn/vo1}
% ch8 直接法
\include{chapters-cn/vo2}
% ch9 后端1
\include{chapters-cn/backend1}
% ch10 后端2
\include{chapters-cn/backend2}
% ch11 回环检测
\include{chapters-cn/loopclosure}
% ch12 建图
\include{chapters-cn/mapping}
% VIO (还在考虑写或不写，实验不好设计)
% \include{chapters/vio}
% ch13 SLAM工程
\include{chapters-cn/designTracker}
% ch14 SLAM：过去与未来
\include{chapters-cn/state-of-the-art}

\appendix % 开始附录，章用字母编号
\addtocontents{toc}{\protect\setcounter{tocdepth}{0}}
\hypersetup{bookmarksdepth=2}
\input{chapters-cn/gaussian-distribution}
\input{chapters-cn/matrix-derivatives}
\include{chapters-cn/ROS}
 
\backmatter
\pagestyle{special}
\small
\bibliographystyle{ieeetr}
\bibliography{ref}
%\input{31104.bbl}
\newpage
\end{document}
